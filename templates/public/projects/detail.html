{% extends "layout/base.html" %}

{% block title %}{{ get_loc_attr(project, 'title') }} ‚Äì Carlos Sibrian{% endblock %}

{% block content %}
<section class="project-detail-shell">
  <div class="detail-reading-bg" aria-hidden="true"></div>

  <div class="container">

    {# --- 1) TOP NAV --- #}
    <div class="project-topnav">
      <a href="{{ url_for('projects_list') }}" class="project-back">
        <span aria-hidden="true">&larr;</span>
        <span>{{ t('projects') }}</span>
      </a>

      <span class="project-id-pill">
        ID: {{ project.slug | upper }}
      </span>
    </div>

    {# --- 2) HERO --- #}
    <header class="project-hero">
      <div class="project-title-row">
        <h1 class="display-4 fw-bold text-light project-title">
          {{ get_loc_attr(project, 'title') }}
        </h1>

        {% if project.is_featured %}
          <span class="featured-pill" title="Featured Project">‚òÖ</span>
        {% endif %}
      </div>

      <p class="project-lead">
        {{ get_loc_attr(project, 'summary') }}
      </p>

      <div class="reading-divider" aria-hidden="true"></div>
    </header>

    {# --- 3) MEDIA: CYBER BROWSER WINDOW --- #}
    <div class="cyber-browser mb-5">

      <div class="browser-header">
        <div class="window-controls">
          <span class="dot red"></span>
          <span class="dot yellow"></span>
          <span class="dot green"></span>
        </div>

        <div class="address-bar">
          <span class="lock-icon" aria-hidden="true">üîí</span>

          {% if project.live_url %}
            <a href="{{ project.live_url }}" target="_blank" class="url-text"
               title="Open Live Site in new tab">
              https://{{ project.live_url.replace('https://', '').replace('http://', '').split('/')[0] }}
              <span style="opacity: 0.5; font-size: 0.85em; margin-left: 6px;" aria-hidden="true">‚Üó</span>
            </a>
          {% else %}
            <span class="url-text" style="cursor: default;">
              localhost:8080/projects/{{ project.slug }}
            </span>
          {% endif %}
        </div>

        <div class="window-menu" aria-hidden="true">
          <span class="menu-lines"></span>
        </div>
      </div>

      <div class="browser-viewport">

        {% if project.video_url %}
          <div style="width: 100%; height: 100%; background: #000;">
            <video autoplay muted loop playsinline controls
                   style="width: 100%; height: 100%; object-fit: contain;">
              <source src="{{ project.video_url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>

        {% elif project.cover_image %}
          <div style="width: 100%; height: 100%; position: relative; overflow: hidden;">
            <div style="position: absolute; top:0; left:0; width:100%; height:100%;
                        background-image: url('{{ project.cover_image }}');
                        background-size: cover; filter: blur(22px); opacity: 0.38;"></div>

            <img src="{{ project.cover_image }}"
                 style="position: relative; width: 100%; height: 100%; object-fit: contain; z-index: 2;"
                 alt="{{ project.title }}">
          </div>

        {% else %}
          <div class="w-100 bg-dark d-flex align-items-center justify-content-center" style="height: 100%;">
            <span class="text-secondary" style="font-family: monospace;">NO_VISUAL_DATA</span>
          </div>
        {% endif %}

      </div>
    </div>

    {# --- 4) CONTENT + SIDEBAR --- #}
    <div class="row gx-5">

      <div class="col-lg-8 mb-5 mb-lg-0">
        <h4 class="text-secondary text-uppercase mb-4 section-title project-body-title">
          Project Details
        </h4>

        <div class="description-content text-light">
          {% set desc = get_loc_attr(project, 'description') %}
          {% if desc %}
            {{ desc.replace('\n', '<br>') | safe }}
          {% else %}
            <p class="text-muted fst-italic">
              {{ get_loc_attr(project, 'summary') }}
            </p>
          {% endif %}
        </div>
      </div>

      <div class="col-lg-4">
        <div class="hud-panel p-4">

          <div class="mb-5 position-relative">
            <h5 class="small-title mb-3">Tech Stack</h5>

            {% if project.tech_stack %}
              <div class="d-flex flex-wrap gap-2">
                {% for tech in project.tech_stack.split(',') %}
                  <span class="tech-badge">{{ tech.strip() }}</span>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="position-relative">
            <h5 class="small-title mb-3">Access</h5>

            <div class="d-grid gap-3">
              {% if project.live_url %}
                <a href="{{ project.live_url }}" target="_blank" class="btn-hud">
                  <span><span class="text-info me-2">‚óè</span> Live Demo</span>
                  <span>&nearr;</span>
                </a>
              {% endif %}

              {% if project.repo_url %}
                <a href="{{ project.repo_url }}" target="_blank" class="btn-hud">
                  <span><span class="text-warning me-2">‚óè</span> Source Code</span>
                  <span style="font-family: monospace;">&lt;/&gt;</span>
                </a>
              {% endif %}
            </div>
          </div>

        </div>
      </div>

    </div>

  </div>
</section>
{% endblock %}
