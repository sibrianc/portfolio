{% extends "layout/base.html" %}

{% block title %}{{ t('projects') }} – Carlos Sibrian{% endblock %}

{% block content %}
<div style="position: relative; z-index: 5; padding-top: 50px;">
  
  <div class="container text-center mb-4">
    <h1 class="text-light display-4 fw-bold" style="letter-spacing: 3px; text-transform: uppercase; text-shadow: 0 0 20px rgba(0, 170, 255, 0.4);">
      {{ t('projects') }}
    </h1>
    <div style="width: 60px; height: 3px; background: #00aaff; margin: 20px auto;"></div>
  </div>

  <div class="container mb-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="cyber-search-container">
          <span class="me-2 text-info">     </span>
          <form method="get" class="w-100 d-flex">
            <input type="text" name="tech" class="cyber-input" placeholder="Search technology..." value="{{ tech or '' }}" autocomplete="off" style="font-family: 'Segoe UI', sans-serif;">
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="container pb-5">
    <div class="cyber-grid">
      
      {% for project in projects %}
        <a href="{{ url_for('project_detail', slug=project.slug) }}" class="cyber-card">
          
          {# --- ZONA DE MEDIA (VIDEO O IMAGEN) --- #}
          <div class="cyber-img-container">
            {% if project.video_url %}
                {# Opción 1: Video MP4 #}
                <video class="cyber-video" autoplay muted loop playsinline poster="{{ project.cover_image }}">
                  <source src="{{ project.video_url }}" type="video/mp4">
                  <img src="{{ project.cover_image }}" class="cyber-img" alt="Fallback">
                </video>

            {% elif project.cover_image %}
                {# Opción 2: Imagen con Scroll #}
                <img src="{{ project.cover_image }}" class="cyber-img" alt="{{ project.title }}">

            {% else %}
                {# Opción 3: Placeholder #}
                <div class="w-100 h-100 d-flex align-items-center justify-content-center bg-black text-secondary">
                  <span style="font-size: 2rem; opacity: 0.5;">No Image</span>
                </div>
            {% endif %}
          </div>

          <div class="cyber-body">
            <div class="d-flex justify-content-between align-items-start">
              {# TRADUCCIÓN DEL TÍTULO #}
              <h5 class="cyber-title" style="border:none;">{{ get_loc_attr(project, 'title') }}</h5>
              {% if project.is_featured %}
                <span class="text-warning" style="font-size:1rem;" title="Featured">★</span>
              {% endif %}
            </div>

            {# TRADUCCIÓN DEL RESUMEN #}
            <p class="cyber-summary">{{ get_loc_attr(project, 'summary') | truncate(100) }}</p>

            {% if project.tech_stack %}
            <div class="tech-cloud">
              {% for tech in project.tech_stack.split(',')[:4] %}
                <span class="tech-tag">{{ tech.strip() }}</span>
              {% endfor %}
              {% if project.tech_stack.split(',')|length > 4 %}
                <span class="tech-tag" style="opacity: 0.5;">...</span>
              {% endif %}
            </div>
            {% endif %}

            <div class="cyber-footer">
              <span class="btn-cyber-link">
                View Project <span style="font-size:1.2em;">&rsaquo;</span>
              </span>
            </div>
          </div>
        </a>
      {% endfor %}

    </div>

    {% if not projects %}
      <div class="text-center w-100 py-5 text-light">
        <h3 class="text-muted">No projects found.</h3>
        <a href="{{ url_for('projects_list') }}" class="btn btn-sm btn-outline-light mt-3">Clear Search</a>
      </div>
    {% endif %}

  </div>

</div>
{% endblock %}