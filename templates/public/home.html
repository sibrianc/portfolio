{% extends "layout/base.html" %}
{% block title %}{{ t('home') }} – Carlos Sibrian{% endblock %}

{# --- SOBRESCRIBIMOS EL NAVBAR PARA EL HOME --- #}
{# En lugar de la barra completa, solo mostramos el botón de idioma flotando arriba a la derecha #}
{% block navbar %}
<div class="position-fixed top-0 end-0 p-4" style="z-index: 2000;">
    <a class="btn btn-sm btn-outline-light rounded-pill px-3" 
       href="{{ url_for('switch_lang', code='en' if current_lang()=='es' else 'es') }}"
       style="backdrop-filter: blur(5px); background: rgba(0,0,0,0.2); box-shadow: 0 0 15px rgba(0,0,0,0.5);">
      {{ current_lang()|upper }}
    </a>
</div>
{% endblock %}

{% block content %}

{# --- MENÚ 3D (Sin el idioma dentro) --- #}
<div id="menu-container">
    <a href="{{ url_for('about') }}" class="menu-item">{{ t('about') }}</a>
    <a href="{{ url_for('projects_list') }}" class="menu-item">{{ t('projects') }}</a>
    <a href="{{ url_for('contact') }}" class="menu-item">{{ t('contact') }}</a>
</div>

<div style="height: 100vh; width: 100%;"></div>

<div id="featured-section" class="container-fluid pt-5 position-relative" style="z-index: 10; background: transparent; min-height: 100vh; padding-left: 0; padding-right: 0; padding-bottom: 0 !important;">
  
  <div class="container mt-5">
    <div class="text-center mb-5">
      <h2 class="text-light fw-bold display-5 text-uppercase" style="letter-spacing: 3px; text-shadow: 0 0 20px rgba(189, 75, 0, 0.5);">Featured Projects</h2>
      <p class="text-secondary">Selected works from the archive</p>
    </div>
  </div>

  {% if featured %}
    
    <div class="cyber-carousel-wrapper">
      
      <div id="projectsCarousel" class="carousel slide mx-auto" data-bs-ride="carousel" data-bs-interval="5000" style="width: 100%; max-width: 1000px;"> 
        
        <div class="carousel-inner" style="overflow: visible;"> 
          {% for project in featured %}
            <div class="carousel-item {% if loop.first %}active{% endif %}">
              
              <a href="{{ url_for('project_detail', slug=project.slug) }}" class="cyber-card mx-auto" style="max-width: 380px; min-height: 450px;">
                
                {# --- ZONA DE MEDIA (VIDEO O IMAGEN) --- #}
                <div class="cyber-img-container">
                  {% if project.video_url %}
                     {# OPCIÓN 1: VIDEO MP4 #}
                     {# Se reproduce solo, sin sonido y en bucle. Se ve super pro. #}
                     <video class="cyber-video" autoplay muted loop playsinline poster="{{ project.cover_image }}">
                        <source src="{{ project.video_url }}" type="video/mp4">
                        {# Fallback a imagen si el video falla #}
                        <img src="{{ project.cover_image }}" class="cyber-img" alt="{{ project.title }}">
                     </video>

                  {% elif project.cover_image %}
                     {# OPCIÓN 2: IMAGEN (Con efecto scroll al pasar el mouse) #}
                     <img src="{{ project.cover_image }}" class="cyber-img" alt="{{ project.title }}">

                  {% else %}
                     {# OPCIÓN 3: PLACEHOLDER #}
                     <div class="w-100 h-100 d-flex align-items-center justify-content-center bg-black text-secondary">
                        <span style="font-size: 3rem; opacity: 0.5;">NO_SIGNAL</span>
                     </div>
                  {% endif %}
                </div>

                <div class="cyber-body">
                  <div class="d-flex justify-content-between align-items-start">
                    {# Título traducido #}
                    <h3 class="cyber-title" style="border:none; font-size: 1.3rem;">{{ get_loc_attr(project, 'title') }}</h3>
                    <span class="text-warning" style="font-size:1.1rem;" title="Featured">★</span>
                  </div>
                  
                  {# Resumen traducido #}
                  <p class="cyber-summary" style="font-size: 0.85rem;">
                    {{ get_loc_attr(project, 'summary') | truncate(110) }}
                  </p>

                  {% if project.tech_stack %}
                  <div class="tech-cloud mb-3">
                    {% for tech in project.tech_stack.split(',')[:3] %}
                      <span class="tech-tag">{{ tech.strip() }}</span>
                    {% endfor %}
                  </div>
                  {% endif %}

                  <div class="cyber-footer mt-auto">
                    <span class="btn-cyber-link" style="font-size: 0.9rem; cursor: pointer;">
                      View Details <span style="font-size:1.2em;">&rsaquo;</span>
                    </span>
                  </div>
                </div>

              </a> </div>
          {% endfor %}
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#projectsCarousel" data-bs-slide="prev" style="width: 5%; left: -30px;">
          <span class="carousel-control-prev-icon" aria-hidden="true" style="filter: drop-shadow(0 0 5px #00aaff); transform: scale(1.5);"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#projectsCarousel" data-bs-slide="next" style="width: 5%; right: -30px;">
          <span class="carousel-control-next-icon" aria-hidden="true" style="filter: drop-shadow(0 0 5px #00aaff); transform: scale(1.5);"></span>
        </button>

      </div>
    </div>

  {% else %}
    <div class="text-center w-100 py-5 text-muted"><h4>No featured projects found.</h4></div>
  {% endif %}

</div>
{% endblock %}